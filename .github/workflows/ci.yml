name: R CI â€” lintr & styler check

on:
  push:
  pull_request:

jobs:
  lintr-and-styler:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up R
        uses: r-lib/actions/setup-r@v2

      - name: Install required packages
        run: |
          Rscript -e 'install.packages(c("lintr","styler","remotes","devtools"), repos="https://cloud.r-project.org")'

      - name: Run lintr and fail on lints
        run: |
          Rscript -e 'l <- lintr::lint_package(); if (length(l) > 0) { print(l); quit(status=1) }'

      - name: Run styler check (fail if style modifies files)
        run: |
          git status --porcelain > /tmp/pre
          Rscript -e 'styler::style_pkg()'
          if [ -n "$(git status --porcelain)" ]; then
            echo "Styler changed files:" >&2
            git --no-pager diff --name-only
            git --no-pager diff
            exit 1
          fi
